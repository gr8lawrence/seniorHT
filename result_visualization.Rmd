---
title: "Machine Learning Performances Visualization"
author: "Tianyi Liu"
date: "1/16/2019"
output: html_document
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(ggpubr)
```

```{r load_data, include = FALSE}
data_path <- "/Users/gr8lawrence/Desktop/Senior Honors Thesis/R_output_from_cluster/"

fr <- list()

load(paste(data_path, "learning_result_RT_rf.Rdata", sep = ""))
fr[[1]] <- final_results

load(paste(data_path, "learning_result_RT_svm.Rdata", sep = ""))
fr[[2]] <- final_results

load(paste(data_path, "learning_result_TSPs_rf_tp_100.Rdata", sep = ""))
fr[[3]] <- final_results

load(paste(data_path, "learning_result_TSPs_svm_tp_500.Rdata", sep = ""))
fr[[4]] <- final_results
```

## Overview

In this document, we present several visualizations of our results that demonstrate the performances of various combinations of data processing and machine learning models. 

### Data Processing

In this section, we process our data and combine everything in a giant tibble file so that downstream tasks of plotting the data would be a lot easier. We have already loaded the data from runs on the clusters and only need to rearrange them now. The `tibble` below presents the final arrangement.

```{r data_processing, echo = FALSE}
results_tibble_list <- list()
results_tibble <- tibble() # This is the final giant tibble

for (i in c(2, 4)) {
  fr[[i]]$results <- fr[[i]]$results[ ,-c(3, 4)]
  colnames(fr[[i]]$results)[1:2] <- c("training.set", "test.set")
  fr[[i]]$results <- fr[[i]]$results %>% add_column(strategy = "Single") 
  for (j in 1:dim(fr[[i]]$results)[1]) {
    if (substr(fr[[i]]$results$training.set[j], 1, 4) == "comb" || substr(fr[[i]]$results$training.set[j], 1, 4) == "Comb" ) {
      fr[[i]]$results$training.set[j] <- "Combined"
      fr[[i]]$results$strategy[j] <- "Combined"
    } 
  }
  if (i == 2) {
    results_tibble_list[[i]] <- fr[[i]]$results %>% mutate(method = "SVM", transformation = "Rank")
  } else {
    results_tibble_list[[i]] <- fr[[i]]$results %>% mutate(method = "SVM", transformation = "TSPs")
  }
}


for (i in c(1, 3)) {
  colnames(fr[[i]]$results)[1:2] <- c("training.set", "test.set")
  fr[[i]]$results <- fr[[i]]$results %>% add_column(strategy = "Single") 
  for (j in 1:dim(fr[[i]]$results)[1]) {
    if (substr(fr[[i]]$results$training.set[j], 1, 4) == "comb" || substr(fr[[i]]$results$training.set[j], 1, 4) == "Comb" ) {
      fr[[i]]$results$training.set[j] <- "Combined"
      fr[[i]]$results$strategy[j] <- "Combined"
    } 
  }
  if (i == 1) {
    results_tibble_list[[i]] <- fr[[i]]$results %>% mutate(method = "RF", transformation = "Rank")
  } else {
    results_tibble_list[[i]] <- fr[[i]]$results %>% mutate(method = "RF", transformation = "TSPs")
  }
}


results_tibble <- rbind(results_tibble_list[[1]], results_tibble_list[[2]], results_tibble_list[[3]], results_tibble_list[[4]])

results_tibble <- results_tibble[order(results_tibble$transformation), ]  
results_tibble$accuracy <- as.numeric(results_tibble$accuracy)
results_tibble$sensitivity <- as.numeric(results_tibble$sensitivity)
results_tibble$specificity <- as.numeric(results_tibble$specificity)
results_tibble$method <- factor(results_tibble$method, levels = c("PLR", "RF", "SVM", "MTL"))
results_tibble$transformation <- factor(results_tibble$transformation, levels = c("Rank", "TSPs"))
results_tibble$strategy <- factor(results_tibble$strategy, levels = c("Single", "Combined"))


print(results_tibble, n = 10)
```

### Prediction Accuracy

One measurement of performances for any machine learning program is the prediction accuracy. Here, we present the boxplots for the accuracies of several of our combinations of data transformation methods, learning methods, and  learning strategies.

```{r pred_accu, echo = FALSE}
ggplot(data = results_tibble, aes(x = interaction(transformation, strategy, sep = "-"), y = accuracy, fill = interaction(transformation, strategy, sep = "-"))) +
  geom_boxplot(alpha = 0.8, width = 0.25) +
  ggtitle("Comparison of Prediction Accuracy") +
  xlab("Transformation-Strategy") +
  ylab("Accuracy") +
  theme_classic() + facet_grid(.~method) +
  theme(axis.text.x = element_text(vjust = 0.5, angle = 90)) +
  scale_fill_discrete(name = "Trans/Strategy")

```

```{r pred_accu_method, echo = FALSE}
ggplot(data = results_tibble, aes(x = method, y = accuracy, fill = method)) +
  geom_boxplot(alpha = 0.8, width = 0.25) +
  ggtitle("Comparison of Prediction Accuracy", subtitle = "by learning method") +
  xlab("Method") +
  ylab("Accuracy") +
  theme_classic() +
  scale_fill_discrete(name = "Method")
```

```{r pred_accu_transoformation, echo = FALSE}
ggplot(data = results_tibble, aes(x = transformation, y = accuracy, fill = transformation)) +
  geom_boxplot(alpha = 0.8, width = 0.25) +
  ggtitle("Comparison of Prediction Accuracy", subtitle = "by transformation method") +
  xlab("Transformation") +
  ylab("Accuracy") +
  theme_classic() +
  scale_fill_discrete(name = "Transformation")
```

```{r pred_accu_strategy, echo = FALSE}
ggplot(data = results_tibble, aes(x = strategy, y = accuracy, fill = strategy)) +
  geom_boxplot(alpha = 0.8, width = 0.25) +
  ggtitle("Comparison of Prediction Accuracy", subtitle = "by learning strategy") +
  xlab("Strategy") +
  ylab("Accuracy") +
  theme_classic() +
  scale_fill_discrete(name = "Strategy")
```

### Prediction Sensitivity

```{r pred_sensitvity, echo = FALSE}
ggplot(data = results_tibble, aes(x = interaction(transformation, strategy, sep = "-"), y = accuracy, col = interaction(transformation, strategy, sep = "-"))) +
  geom_boxplot(alpha = 0.8, width = 0.25) +
  ggtitle("Comparison of Prediction Senstivity") +
  xlab("Tranformation-Strategy") +
  ylab("Sensitivity") +
  theme_classic() + facet_grid(. ~ method) +
  theme(axis.text.x = element_text(vjust = 0.5, angle = 90)) + 
  scale_color_discrete(name = "Trans/Strategy")
```

```{r pred_sensitvity_method, echo = FALSE}
ggplot(data = results_tibble, aes(x = method, y = sensitivity, fill = method)) +
  geom_boxplot(alpha = 0.8, width = 0.25) +
  ggtitle("Comparison of Prediction Senstivity", subtitle = "by learning method") +
  xlab("Method") +
  ylab("Sensitivity") +
  theme_classic() + 
  scale_fill_discrete(name = "Method") 
```

```{r pred_sensitvity_transformation, echo = FALSE}
ggplot(data = results_tibble, aes(x = transformation, y = sensitivity, fill = transformation)) +
  geom_boxplot(alpha = 0.8, width = 0.25) +
  ggtitle("Comparison of Prediction Senstivity", subtitle = "by transformation method") +
  xlab("Transformation Method") +
  ylab("Sensitivity") +
  theme_classic() + 
  scale_fill_discrete(name = "Method") 
```


```{r pred_sensitvity_strategy, echo = FALSE}
ggplot(data = results_tibble, aes(x = strategy, y = sensitivity, fill = strategy)) +
  geom_boxplot(alpha = 0.8, width = 0.25) +
  ggtitle("Comparison of Prediction Senstivity", subtitle = "by learning strategy") +
  xlab("Learning Strategy") +
  ylab("Sensitivity") +
  theme_classic() + 
  scale_fill_discrete(name = "Strategy") 
```

### Prediction Specificity

```{r pred_specificity, echo = FALSE}
ggplot(data = results_tibble, aes(x = interaction(transformation, strategy, sep = '-'), y = specificity, fill = interaction(transformation, strategy, sep = '-'))) +
  geom_boxplot(alpha = 0.8, width = 0.25) +
  ggtitle("Comparison of Prediction Specificity") +
  xlab("Transformation/Strategy") +
  ylab("Specificity") +
  theme_classic() + facet_grid(. ~ method) +
  theme(axis.text.x = element_text(vjust = 0.5, angle = 90)) + 
  scale_fill_discrete(name = "Trans/Strategy") 
```

```{r pred_specificity_method, echo = FALSE}
ggplot(data = results_tibble, aes(x = method, y = specificity, fill = method)) +
  geom_boxplot(alpha = 0.8, width = 0.25) +
  ggtitle("Comparison of Prediction Specificity", subtitle = "by learning method") +
  xlab("Method") +
  ylab("Specificity") +
  theme_classic() +
  scale_fill_discrete(name = "Method") 
```

```{r pred_specificity_transformation, echo = FALSE}
ggplot(data = results_tibble, aes(x = transformation, y = specificity, fill = transformation)) +
  geom_boxplot(alpha = 0.8, width = 0.25) +
  ggtitle("Comparison of Prediction Specificity", subtitle = "by transformation method") +
  xlab("Transformation Method") +
  ylab("Specificity") +
  theme_classic() +
  scale_fill_discrete(name = "Transformation Method") 
```

```{r pred_specificity_strategy, echo = FALSE}
ggplot(data = results_tibble, aes(x = strategy, y = specificity, fill = strategy)) +
  geom_boxplot(alpha = 0.8, width = 0.25) +
  ggtitle("Comparison of Prediction Specificity", subtitle = "by learning strategy") +
  xlab("Learning Strategy") +
  ylab("Specificity") +
  theme_classic() +
  scale_fill_discrete(name = "Learning Strategy") 
```











